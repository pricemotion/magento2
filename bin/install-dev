#!/usr/bin/env bash

set -euo pipefail
cd "$(dirname "$0")/.."

package="$(bin/package --dirty)"

rm -rf artifacts
mkdir artifacts
ln "$package" "artifacts/${package##*/}"

jq '
	.repositories =
		[
			{
				type: "artifact",
				url: "../artifacts"
			}
		]
		+ (.repositories | map(select(.type != "artifact")))
' www/composer.json > www/composer.json.$$
mv www/composer.json.$$ www/composer.json

"vendor/bin/composer" -d www require --ignore-platform-reqs pricemotion/module-pricemotion@dev

# Run module setup
# Clear caches
# See: %.bak
